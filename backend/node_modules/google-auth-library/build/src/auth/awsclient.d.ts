<<<<<<< HEAD
import { AwsSecurityCredentials } from './awsrequestsigner';
import { BaseExternalAccountClient, BaseExternalAccountClientOptions, ExternalAccountSupplierContext } from './baseexternalclient';
import { AuthClientOptions } from './authclient';
import { SnakeToCamelObject } from '../util';
=======
import { BaseExternalAccountClient, BaseExternalAccountClientOptions } from './baseexternalclient';
import { RefreshOptions } from './oauth2client';
>>>>>>> 8a6fc10 (firebase hosting)
/**
 * AWS credentials JSON interface. This is used for AWS workloads.
 */
export interface AwsClientOptions extends BaseExternalAccountClientOptions {
<<<<<<< HEAD
    /**
     * Object containing options to retrieve AWS security credentials. A valid credential
     * source or a aws security credentials supplier should be specified.
     */
    credential_source?: {
        /**
         * AWS environment ID. Currently only 'AWS1' is supported.
         */
        environment_id: string;
        /**
         * The EC2 metadata URL to retrieve the current AWS region from. If this is
         * not provided, the region should be present in the AWS_REGION or AWS_DEFAULT_REGION
         * environment variables.
         */
        region_url?: string;
        /**
         * The EC2 metadata URL to retrieve AWS security credentials. If this is not provided,
         * the credentials should be present in the AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY,
         * and AWS_SESSION_TOKEN environment variables.
         */
        url?: string;
        /**
         * The regional GetCallerIdentity action URL, used to determine the account
         * ID and its roles.
         */
        regional_cred_verification_url: string;
        /**
         *  The imdsv2 session token url is used to fetch session token from AWS
         *  which is later sent through headers for metadata requests. If the
         *  field is missing, then session token won't be fetched and sent with
         *  the metadata requests.
         *  The session token is required for IMDSv2 but optional for IMDSv1
         */
        imdsv2_session_token_url?: string;
    };
    /**
     * The AWS security credentials supplier to call to retrieve the AWS region
     * and AWS security credentials. Either this or a valid credential source
     * must be specified.
     */
    aws_security_credentials_supplier?: AwsSecurityCredentialsSupplier;
}
/**
 * Supplier interface for AWS security credentials. This can be implemented to
 * return an AWS region and AWS security credentials. These credentials can
 * then be exchanged for a GCP token by an {@link AwsClient}.
 */
export interface AwsSecurityCredentialsSupplier {
    /**
     * Gets the active AWS region.
     * @param context {@link ExternalAccountSupplierContext} from the calling
     *   {@link AwsClient}, contains the requested audience and subject token type
     *   for the external account identity as well as the transport from the
     *   calling client to use for requests.
     * @return A promise that resolves with the AWS region string.
     */
    getAwsRegion: (context: ExternalAccountSupplierContext) => Promise<string>;
    /**
     * Gets valid AWS security credentials for the requested external account
     * identity. Note that these are not cached by the calling {@link AwsClient},
     * so caching should be including in the implementation.
     * @param context {@link ExternalAccountSupplierContext} from the calling
     *   {@link AwsClient}, contains the requested audience and subject token type
     *   for the external account identity as well as the transport from the
     *   calling client to use for requests.
     * @return A promise that resolves with the requested {@link AwsSecurityCredentials}.
     */
    getAwsSecurityCredentials: (context: ExternalAccountSupplierContext) => Promise<AwsSecurityCredentials>;
=======
    credential_source: {
        environment_id: string;
        region_url?: string;
        url?: string;
        regional_cred_verification_url: string;
        imdsv2_session_token_url?: string;
    };
>>>>>>> 8a6fc10 (firebase hosting)
}
/**
 * AWS external account client. This is used for AWS workloads, where
 * AWS STS GetCallerIdentity serialized signed requests are exchanged for
 * GCP access token.
 */
export declare class AwsClient extends BaseExternalAccountClient {
<<<<<<< HEAD
    #private;
    private readonly environmentId?;
    private readonly awsSecurityCredentialsSupplier;
    private readonly regionalCredVerificationUrl;
    private awsRequestSigner;
    private region;
    /**
     * @deprecated AWS client no validates the EC2 metadata address.
     **/
    static AWS_EC2_METADATA_IPV4_ADDRESS: string;
    /**
     * @deprecated AWS client no validates the EC2 metadata address.
     **/
=======
    private readonly environmentId;
    private readonly regionUrl?;
    private readonly securityCredentialsUrl?;
    private readonly regionalCredVerificationUrl;
    private readonly imdsV2SessionTokenUrl?;
    private awsRequestSigner;
    private region;
    static AWS_EC2_METADATA_IPV4_ADDRESS: string;
>>>>>>> 8a6fc10 (firebase hosting)
    static AWS_EC2_METADATA_IPV6_ADDRESS: string;
    /**
     * Instantiates an AwsClient instance using the provided JSON
     * object loaded from an external account credentials file.
     * An error is thrown if the credential is not a valid AWS credential.
     * @param options The external account options object typically loaded
     *   from the external account JSON credential file.
<<<<<<< HEAD
     * @param additionalOptions **DEPRECATED, all options are available in the
     *   `options` parameter.** Optional additional behavior customization options.
     *   These currently customize expiration threshold time and whether to retry
     *   on 401/403 API request errors.
     */
    constructor(options: AwsClientOptions | SnakeToCamelObject<AwsClientOptions>, additionalOptions?: AuthClientOptions);
    private validateEnvironmentId;
    /**
     * Triggered when an external subject token is needed to be exchanged for a
     * GCP access token via GCP STS endpoint. This will call the
     * {@link AwsSecurityCredentialsSupplier} to retrieve an AWS region and AWS
     * Security Credentials, then use them to create a signed AWS STS request that
     * can be exchanged for a GCP access token.
     * @return A promise that resolves with the external subject token.
     */
    retrieveSubjectToken(): Promise<string>;
=======
     * @param additionalOptions Optional additional behavior customization
     *   options. These currently customize expiration threshold time and
     *   whether to retry on 401/403 API request errors.
     */
    constructor(options: AwsClientOptions, additionalOptions?: RefreshOptions);
    private validateEnvironmentId;
    /**
     * Triggered when an external subject token is needed to be exchanged for a
     * GCP access token via GCP STS endpoint.
     * This uses the `options.credential_source` object to figure out how
     * to retrieve the token using the current environment. In this case,
     * this uses a serialized AWS signed request to the STS GetCallerIdentity
     * endpoint.
     * The logic is summarized as:
     * 1. If imdsv2_session_token_url is provided in the credential source, then
     *    fetch the aws session token and include it in the headers of the
     *    metadata requests. This is a requirement for IDMSv2 but optional
     *    for IDMSv1.
     * 2. Retrieve AWS region from availability-zone.
     * 3a. Check AWS credentials in environment variables. If not found, get
     *     from security-credentials endpoint.
     * 3b. Get AWS credentials from security-credentials endpoint. In order
     *     to retrieve this, the AWS role needs to be determined by calling
     *     security-credentials endpoint without any argument. Then the
     *     credentials can be retrieved via: security-credentials/role_name
     * 4. Generate the signed request to AWS STS GetCallerIdentity action.
     * 5. Inject x-goog-cloud-target-resource into header and serialize the
     *    signed request. This will be the subject-token to pass to GCP STS.
     * @return A promise that resolves with the external subject token.
     */
    retrieveSubjectToken(): Promise<string>;
    /**
     * @return A promise that resolves with the IMDSv2 Session Token.
     */
    private getImdsV2SessionToken;
    /**
     * @param headers The headers to be used in the metadata request.
     * @return A promise that resolves with the current AWS region.
     */
    private getAwsRegion;
    /**
     * @param headers The headers to be used in the metadata request.
     * @return A promise that resolves with the assigned role to the current
     *   AWS VM. This is needed for calling the security-credentials endpoint.
     */
    private getAwsRoleName;
    /**
     * Retrieves the temporary AWS credentials by calling the security-credentials
     * endpoint as specified in the `credential_source` object.
     * @param roleName The role attached to the current VM.
     * @param headers The headers to be used in the metadata request.
     * @return A promise that resolves with the temporary AWS credentials
     *   needed for creating the GetCallerIdentity signed request.
     */
    private getAwsSecurityCredentials;
    private shouldUseMetadataServer;
    private get regionFromEnv();
    private get securityCredentialsFromEnv();
>>>>>>> 8a6fc10 (firebase hosting)
}
